<%= form_with url: create_child_user_accounts_path(format: :html), method: :post, 
html: { id: "account-form" }, 
data: {
  controller: "child-create",
  action: "submit->child-create#handleSubmit",
  "child-create-url-value": create_child_user_accounts_path(format: :json),
  "child-create-redirect-value": root_path
} do |form| %>

 <div id="form-errors" class="hidden mb-4 bg-red-50 border-l-4 border-red-500 p-4"></div>

  <!-- Avatar Section -->
  <div class="mb-8 text-center" data-controller="avatar">
    <div class="mx-auto w-32 h-32 mb-4 rounded-full relative bg-gradient-to-br from-blue-50 to-gray-100 shadow-lg border-4 border-white">
      <div data-loading-indicator-target="loadingIndicator" class="loading-indicator hidden absolute inset-0 flex items-center justify-center bg-black bg-opacity-20 rounded-full">
        <%= render "shared/loading_spinner" %>
      </div>
      <div class="panzoom-container absolute inset-0 overflow-hidden rounded-full">
        <%= image_tag "user.png", id: "image", class: "w-full h-full object-cover", 
                      alt: "Avatar Preview", data: { avatar_target: "image" } %>
      </div>
    </div>

    <%= label_tag :avatarInput, class: "cursor-pointer inline-flex justify-center items-center focus:outline-none border border-gray-300 py-2 px-6 rounded-lg shadow-sm text-gray-700 bg-white hover:bg-gray-50 font-medium transition-colors duration-200" do %>
      <%= render "icons/camera" %>
      Browse Photo
    <% end %>

    <div class="text-gray-500 text-sm mt-2">Click to add profile picture</div>
    <%= form.file_field :avatar, id: "avatarInput", class: "hidden", 
                        accept: "image/*", 
                        data: { 
                          avatar_target: "input", 
                          action: "change->avatar#handleFileSelect" 
                        } %>
  </div>

  <!-- Form Fields -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Basic Info -->
    <div class="space-y-4">
      <div>
        <%= form.label :username, "Child's Username", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :username, class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all", placeholder: "username", required: true %>
      </div>

      <div>
        <%= form.label :first_name, class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :first_name, class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all", placeholder: "first name", required: true %>
      </div>

      <div>
        <%= form.label :last_name, class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :last_name, class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all", placeholder: "last name", required: true %>
      </div>
    </div>

    <!-- Additional Info -->
    <div class="space-y-4">
      <div>
        <%= form.label :dob, "Date of Birth", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.date_field :dob, class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all", required: true %>
      </div>

      <div>
        <%= form.label :school_name, "School Name (optional)", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :school_name, class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all", placeholder: "school name" %>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= form.label :height, "Height (cm)", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.number_field :height, class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all", placeholder: "height" %>
        </div>

        <div>
          <%= form.label :weight, "Weight (kg)", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.number_field :weight, class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all", placeholder: "weight" %>
        </div>
      </div>
    </div>
  </div>

  <!-- Password Field -->
  <div class="pt-2" data-controller="visibility">
    <%= form.label :password, class: "block text-sm font-medium text-gray-700 mb-1" %>
    <div class="relative">
      <%= form.password_field :password, placeholder: "••••••", 
                              class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10",
                              data: { visibility_target: "password" } %>
      <button type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center" data-action="click->visibility#toggleVisibility">
        <%= render "icons/eye" %>
      </button>
    </div>
  </div>

  <!-- Submit Button -->
  <div class="pt-4">
    <%= form.submit "Create Child's Account", 
                    data: { child_create_target: "submit", turbo_submits_with: "Loading..." },
                    class: "btn" %>
  </div>
<% end %>