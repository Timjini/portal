<aside id="sidebar"
   aria-label="Main sidebar"
   class="hidden lg:flex fixed left-0 top-0 h-screen w-56 flex-col pt-8 pb-6 px-3 shadow-sm z-10 overflow-y-auto"
   >
   <!-- Logo -->
   <div class="mb-8 pl-1">
      <a class="md_dashboard_logo" href="/">
      <%= image_tag('cfs-dark.png', alt: "Logo", class: 'h-auto w-10 hover:opacity-80 transition-opacity') %>
      </a>
   </div>
   <!-- Main navigation -->
   <nav class="flex-1 flex flex-col space-y-1" role="navigation" aria-label="Primary">
      <!-- Role-specific -->
      <% nav_items_for_current_user.each do |item| %>
      <div class="nav-group">
         <div
            class="flex items-center gap-2 py-2 px-2 rounded-md transition-colors nav_item
            <%= 'bg-blue-200 font-semibold' if request.path == item[:path] %>">
            <!-- Main Link -->
            <%= link_to item[:path], class: "flex items-center gap-2 flex-1" do %>
            <span class="material-symbols-outlined text-gray-500 text-[20px] group-hover:text-gray-700">
            <%= render partial: "icons/#{item[:icon]}" %>
            </span>
            <span class="text-sm font-normal text-gray-600 group-hover:text-gray-900"><%= item[:name] %></span>
            <% end %>
            <!-- Arrow Toggle -->
            <% if item[:children] %>
            <span class="ml-auto material-symbols-outlined arrow transition-transform duration-200 cursor-pointer"
               onclick="this.closest('.nav-group').querySelector('.children').classList.toggle('hidden'); this.classList.toggle('rotate-90')">
            keyboard_arrow_right
            </span>
            <% end %>
         </div>
         <% if item[:children] %>
         <div class="children ml-6 flex-col space-y-1 mt-1 hidden">
            <% item[:children].each do |child| %>
            <%= link_to child[:path],
               class: "group flex items-center gap-2 py-1 px-2 rounded-md transition-colors nav_item #{'bg-blue-100 font-semibold' if request.path == child[:path]} hover:bg-gray-50" do %>
            <span class="material-symbols-outlined text-gray-400 text-[18px] group-hover:text-gray-600">
            <%= render partial: "icons/#{child[:icon]}" %>
            </span>
            <span class="text-sm font-normal text-gray-500 group-hover:text-gray-700"><%= child[:name] %></span>
            <% end %>
            <% end %>
         </div>
         <% end %>
      </div>
      <%end%>
   </nav>
   <!-- Footer -->
   <div class="sidebar-footer pt-4 border-t border-gray-100 mt-auto px-1">
      <a href="/users/<%= current_user.id %>" class="flex items-center gap-2 mb-3 p-1 rounded-md hover:bg-gray-50 transition-colors">
         <% if current_user.avatar_thumbnail.present? %>
         <%= image_tag(current_user.avatar_thumbnail, alt: "#{current_user.full_name} avatar", class: "w-7 h-7 rounded-full shadow-sm object-cover border border-gray-200") %>
         <% end %>
         <div class="user-info">
            <div class="user-name text-xs font-medium text-gray-700"><%= current_user.full_name %></div>
            <div class="user-role text-[11px] text-gray-400 capitalize"><%= current_user.role %></div>
         </div>
      </a>
      <div class="group flex items-center gap-2 py-2 px-2 rounded-md hover:bg-gray-50 transition-colors">
         <span class="material-symbols-outlined text-gray-500 text-[20px] group-hover:text-red-500">logout</span>
         <%= button_to "Logout", destroy_user_session_path, method: :delete, class: "text-sm font-normal text-gray-600 group-hover:text-red-500 bg-transparent border-none cursor-pointer p-0" %>
      </div>
   </div>
</aside>
<style>
   :root {
   /* brand color â€” change this value to switch the sidebar accent / gradient */
   --brand-rgb: 77, 168, 218; /* rgb(77,168,218) */
   }
   /* gradient background for the sidebar using the brand variable */
   #sidebar {
   background: linear-gradient(to bottom,
   rgba(var(--brand-rgb), 0.06) 0%,
   rgba(var(--brand-rgb), 0.12) 40%,
   rgba(239, 246, 255, 1) 100%);
   }
   /* Thinner custom scroller */
   #sidebar {
   scrollbar-width: thin;
   scrollbar-color: #e5e7eb transparent;
   }
   #sidebar::-webkit-scrollbar {
   width: 6px;
   height: 6px;
   }
   #sidebar::-webkit-scrollbar-track {
   background: transparent;
   }
   #sidebar::-webkit-scrollbar-thumb {
   background-color: #e5e7eb;
   border-radius: 999px;
   }
   /* nav item micro-interaction */
   .nav_item {
   transition: transform 0.12s ease, background-color 0.12s ease;
   }
   .nav_item:hover { transform: translateX(2px); }
   /* keyboard focus style (keeps accessibility) */
   .nav_item:focus { outline: none; box-shadow: 0 0 0 3px rgba(77,168,218,0.12); }
   /* material symbols weight (keeps visual parity) */
   .material-symbols-outlined {
   font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 20;
   }
   /* make sure the footer sticks at bottom */
   .sidebar-footer { box-sizing: border-box; }
</style>